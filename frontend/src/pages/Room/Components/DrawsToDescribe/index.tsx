import { useContext, useEffect, useState } from 'react';
import { Content, EnumRoundType, ReceivingRound } from '../../../../interfaces/iRound';
import { socket } from '../../../../providers/socket';
import { User } from '../../../../interfaces/iUser';
import Answer from '../../../../components/Answer';
import { Card, Divider, Typography } from 'antd';
import { UserContext } from '../../../../context/UserContext';

const { Title } = Typography;
export const DrawsToDescribe = () => {
    const { user }: { user: User | null } = useContext(UserContext);
    const [draws, setDraws] = useState<Content[]>([
        // {
        //     content:
        //         '{"lines":[{"points":[{"x":251.25,"y":130},{"x":251.25,"y":130},{"x":200.25,"y":142},{"x":196.25,"y":145},{"x":130.25,"y":181},{"x":111.25,"y":200},{"x":102.25,"y":212},{"x":94.25,"y":230},{"x":94.25,"y":234},{"x":94.25,"y":241},{"x":96.25,"y":246},{"x":101.25,"y":253},{"x":104.25,"y":258},{"x":110.25,"y":262},{"x":115.25,"y":268},{"x":122.25,"y":272},{"x":129.25,"y":277},{"x":137.25,"y":281},{"x":148.25,"y":286},{"x":163.25,"y":293},{"x":180.25,"y":296},{"x":199.25,"y":302},{"x":218.25,"y":306},{"x":237.25,"y":308},{"x":259.25,"y":310},{"x":276.25,"y":313},{"x":292.25,"y":317},{"x":307.25,"y":319},{"x":314.25,"y":322},{"x":321.25,"y":323},{"x":322.25,"y":324},{"x":323.25,"y":324},{"x":323.25,"y":325},{"x":324.25,"y":325},{"x":324.25,"y":327},{"x":324.25,"y":331},{"x":322.25,"y":339},{"x":319.25,"y":349},{"x":316.25,"y":355},{"x":308.25,"y":367},{"x":300.25,"y":375},{"x":290.25,"y":384},{"x":274.25,"y":396},{"x":262.25,"y":403},{"x":245.25,"y":410},{"x":224.25,"y":418},{"x":206.25,"y":424},{"x":187.25,"y":428},{"x":171.25,"y":430},{"x":154.25,"y":430},{"x":138.25,"y":430},{"x":127.25,"y":428},{"x":110.25,"y":423},{"x":99.25,"y":418},{"x":93.25,"y":415},{"x":88.25,"y":412},{"x":84.25,"y":410},{"x":83.25,"y":409},{"x":83.25,"y":408},{"x":82.25,"y":405},{"x":82.25,"y":394},{"x":84.25,"y":383},{"x":85.25,"y":372},{"x":90.25,"y":358},{"x":96.25,"y":347},{"x":105.25,"y":326},{"x":117.25,"y":308},{"x":132.25,"y":287},{"x":154.25,"y":265},{"x":187.25,"y":240},{"x":225.25,"y":217},{"x":259.25,"y":202},{"x":291.25,"y":185},{"x":323.25,"y":170},{"x":343.25,"y":158},{"x":352.25,"y":150},{"x":356.25,"y":145},{"x":357.25,"y":145},{"x":356.25,"y":142},{"x":354.25,"y":140},{"x":347.25,"y":133},{"x":340.25,"y":124},{"x":330.25,"y":116},{"x":315.25,"y":107},{"x":303.25,"y":102},{"x":299.25,"y":100},{"x":297.25,"y":99},{"x":296.25,"y":99},{"x":296.25,"y":99}],"brushColor":"#000000","brushRadius":5},{"points":[{"x":274.25,"y":231},{"x":274.25,"y":231},{"x":392.25,"y":358.99999999999994},{"x":392.25,"y":358.99999999999994},{"x":392.25,"y":358.99999999999994},{"x":638.75,"y":-493.00000000000006}],"brushColor":"#000000","brushRadius":5},{"points":[{"x":189.75,"y":142},{"x":189.75,"y":142},{"x":271.75,"y":186.00000000000003},{"x":270.75,"y":186},{"x":269.75,"y":185},{"x":268.75,"y":184},{"x":267.75,"y":184},{"x":267.75,"y":183},{"x":266.75,"y":183},{"x":265.75,"y":181},{"x":264.75,"y":180},{"x":262.75,"y":180},{"x":261.75,"y":179},{"x":261.75,"y":178},{"x":260.75,"y":176},{"x":259.75,"y":176},{"x":257.75,"y":175},{"x":256.75,"y":174},{"x":255.75,"y":173},{"x":254.75,"y":173},{"x":252.75,"y":170},{"x":249.75,"y":168},{"x":247.75,"y":166},{"x":246.75,"y":165},{"x":244.75,"y":164},{"x":243.75,"y":162},{"x":242.75,"y":161},{"x":240.75,"y":160},{"x":239.75,"y":158},{"x":238.75,"y":157},{"x":235.75,"y":155},{"x":233.75,"y":154},{"x":232.75,"y":152},{"x":230.75,"y":149},{"x":226.75,"y":148},{"x":225.75,"y":144},{"x":221.75,"y":142},{"x":215.75,"y":136},{"x":211.75,"y":130},{"x":207.75,"y":126},{"x":203.75,"y":122},{"x":199.75,"y":116},{"x":195.75,"y":112},{"x":191.75,"y":106},{"x":187.75,"y":102},{"x":183.75,"y":98},{"x":177.75,"y":92},{"x":173.75,"y":86},{"x":169.75,"y":82},{"x":165.75,"y":76},{"x":159.75,"y":70},{"x":155.75,"y":66},{"x":151.75,"y":60},{"x":147.75,"y":56},{"x":143.75,"y":50},{"x":139.75,"y":44},{"x":135.75,"y":40},{"x":131.75,"y":34},{"x":127.75,"y":30},{"x":123.75,"y":26},{"x":119.75,"y":20},{"x":115.75,"y":16},{"x":111.75,"y":10.000000000000002},{"x":107.75,"y":6.000000000000001},{"x":103.75,"y":2},{"x":99.75,"y":-3.9999999999999982}],"brushColor":"#000000","brushRadius":5}],"width":500,"height":500}',
        //     id: 1,
        //     match_id: '1d7a5852-bc0e-4fd2-a651-fa1ab14c99bd',
        // },
        // {
        //     content:
        //         '{"lines":[{"points":[{"x":251.25,"y":130},{"x":251.25,"y":130},{"x":200.25,"y":142},{"x":196.25,"y":145},{"x":130.25,"y":181},{"x":111.25,"y":200},{"x":102.25,"y":212},{"x":94.25,"y":230},{"x":94.25,"y":234},{"x":94.25,"y":241},{"x":96.25,"y":246},{"x":101.25,"y":253},{"x":104.25,"y":258},{"x":110.25,"y":262},{"x":115.25,"y":268},{"x":122.25,"y":272},{"x":129.25,"y":277},{"x":137.25,"y":281},{"x":148.25,"y":286},{"x":163.25,"y":293},{"x":180.25,"y":296},{"x":199.25,"y":302},{"x":218.25,"y":306},{"x":237.25,"y":308},{"x":259.25,"y":310},{"x":276.25,"y":313},{"x":292.25,"y":317},{"x":307.25,"y":319},{"x":314.25,"y":322},{"x":321.25,"y":323},{"x":322.25,"y":324},{"x":323.25,"y":324},{"x":323.25,"y":325},{"x":324.25,"y":325},{"x":324.25,"y":327},{"x":324.25,"y":331},{"x":322.25,"y":339},{"x":319.25,"y":349},{"x":316.25,"y":355},{"x":308.25,"y":367},{"x":300.25,"y":375},{"x":290.25,"y":384},{"x":274.25,"y":396},{"x":262.25,"y":403},{"x":245.25,"y":410},{"x":224.25,"y":418},{"x":206.25,"y":424},{"x":187.25,"y":428},{"x":171.25,"y":430},{"x":154.25,"y":430},{"x":138.25,"y":430},{"x":127.25,"y":428},{"x":110.25,"y":423},{"x":99.25,"y":418},{"x":93.25,"y":415},{"x":88.25,"y":412},{"x":84.25,"y":410},{"x":83.25,"y":409},{"x":83.25,"y":408},{"x":82.25,"y":405},{"x":82.25,"y":394},{"x":84.25,"y":383},{"x":85.25,"y":372},{"x":90.25,"y":358},{"x":96.25,"y":347},{"x":105.25,"y":326},{"x":117.25,"y":308},{"x":132.25,"y":287},{"x":154.25,"y":265},{"x":187.25,"y":240},{"x":225.25,"y":217},{"x":259.25,"y":202},{"x":291.25,"y":185},{"x":323.25,"y":170},{"x":343.25,"y":158},{"x":352.25,"y":150},{"x":356.25,"y":145},{"x":357.25,"y":145},{"x":356.25,"y":142},{"x":354.25,"y":140},{"x":347.25,"y":133},{"x":340.25,"y":124},{"x":330.25,"y":116},{"x":315.25,"y":107},{"x":303.25,"y":102},{"x":299.25,"y":100},{"x":297.25,"y":99},{"x":296.25,"y":99},{"x":296.25,"y":99}],"brushColor":"#000000","brushRadius":5},{"points":[{"x":274.25,"y":231},{"x":274.25,"y":231},{"x":392.25,"y":358.99999999999994},{"x":392.25,"y":358.99999999999994},{"x":392.25,"y":358.99999999999994},{"x":638.75,"y":-493.00000000000006}],"brushColor":"#000000","brushRadius":5},{"points":[{"x":189.75,"y":142},{"x":189.75,"y":142},{"x":271.75,"y":186.00000000000003},{"x":270.75,"y":186},{"x":269.75,"y":185},{"x":268.75,"y":184},{"x":267.75,"y":184},{"x":267.75,"y":183},{"x":266.75,"y":183},{"x":265.75,"y":181},{"x":264.75,"y":180},{"x":262.75,"y":180},{"x":261.75,"y":179},{"x":261.75,"y":178},{"x":260.75,"y":176},{"x":259.75,"y":176},{"x":257.75,"y":175},{"x":256.75,"y":174},{"x":255.75,"y":173},{"x":254.75,"y":173},{"x":252.75,"y":170},{"x":249.75,"y":168},{"x":247.75,"y":166},{"x":246.75,"y":165},{"x":244.75,"y":164},{"x":243.75,"y":162},{"x":242.75,"y":161},{"x":240.75,"y":160},{"x":239.75,"y":158},{"x":238.75,"y":157},{"x":235.75,"y":155},{"x":233.75,"y":154},{"x":232.75,"y":152},{"x":230.75,"y":149},{"x":226.75,"y":148},{"x":225.75,"y":144},{"x":221.75,"y":142},{"x":215.75,"y":136},{"x":211.75,"y":130},{"x":207.75,"y":126},{"x":203.75,"y":122},{"x":199.75,"y":116},{"x":195.75,"y":112},{"x":191.75,"y":106},{"x":187.75,"y":102},{"x":183.75,"y":98},{"x":177.75,"y":92},{"x":173.75,"y":86},{"x":169.75,"y":82},{"x":165.75,"y":76},{"x":159.75,"y":70},{"x":155.75,"y":66},{"x":151.75,"y":60},{"x":147.75,"y":56},{"x":143.75,"y":50},{"x":139.75,"y":44},{"x":135.75,"y":40},{"x":131.75,"y":34},{"x":127.75,"y":30},{"x":123.75,"y":26},{"x":119.75,"y":20},{"x":115.75,"y":16},{"x":111.75,"y":10.000000000000002},{"x":107.75,"y":6.000000000000001},{"x":103.75,"y":2},{"x":99.75,"y":-3.9999999999999982}],"brushColor":"#000000","brushRadius":5}],"width":500,"height":500}',
        //     id: 2,
        //     match_id: '1d7a5852-bc0e-4fd2-a651-fa1ab14c99bd',
        // },
    ]);

    function deleteLastDraw(id: number) {
        setDraws(draws.filter((draw_filter) => draw_filter.id !== id));
    }

    useEffect(() => {
        socket.on('receiveRound', async (data: ReceivingRound) => {
            if (data.receiver_id === user?.id) {
                switch (data.type) {
                    case EnumRoundType.DRAW:
                        setDraws((draws) => [
                            ...draws,
                            { content: data.content, match_id: data.match_id, id: draws.length },
                        ]);
                        break;
                    default:
                        break;
                }
            }
        });
    }, []);

    return (
        <Card title="Sentences" style={{ margin: '20px' }}>
            <div style={{ justifyContent: 'center', alignItems: 'center' }}>
                <Title level={1}>You have {draws.length} drawings to describe</Title>
                {draws.map((draw) => (
                    <>
                        <Divider />
                        <Answer
                            sender_id={user?.id ?? ''}
                            draw={draw.content}
                            callbackParent={() => deleteLastDraw(draw.id)}
                            match_id={draw.match_id}
                        />
                    </>
                ))}
            </div>
        </Card>
    );
};
